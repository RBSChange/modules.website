<?xml version="1.0" encoding="UTF-8"?>
<bindings xmlns="http://www.mozilla.org/xbl" xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:xbl="http://www.mozilla.org/xbl">
	<binding id="cSaveTemplate" extends="core.wDialog#wDialog">
		<implementation>
			<method name="onInitialize">
				<body><![CDATA[
										
					this.resizeTo(640, 400);
					var me = this;
					var validCallback = function(event){me.clearErrorMessage(); me.checkSubmit();};
					var errorCallback = function(event){me.setErrorMessage(event.originalTarget.errormessage); me.checkSubmit();};
					this.addEventListener('fieldError', errorCallback, true);
           			this.addEventListener('fieldValidated', validCallback, true);
					
				]]></body>
			</method>
			
			<method name="checkSubmit">
				<body><![CDATA[
	    			var button = this.getElementById('submitButton');
	    			button.disabled = !this.getElementById('savetpl_label').valid;	    	
	    		]]></body>
			</method>
			
			<method name="setErrorMessage">
				<parameter name="message" />
				<body><![CDATA[
                	this.getElementById("message-box").showMessage("error", message);
                ]]></body>
			</method>
			
			<method name="clearErrorMessage">
				<body><![CDATA[
                	this.getElementById("message-box").clear();
                ]]></body>
			</method>
			
			<method name="onOk">
				<body><![CDATA[
					try
					{
						this.parameters.label = this.getElementById('savetpl_label').value;
						this.parameters.description = this.getElementById('savetpl_description').value;
						this.sender.performSaveTemplate(this.parameters);
	        			this.controller.closeModalDialog(true);	
        			}
        			catch (e)
	 				{
	 					wCore.error("onOk", [], e);
	 				}
        		]]></body>
			</method>
			
		</implementation>

		<xbl:content xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul" 
			xmlns:html="http://www.w3.org/1999/xhtml" 
			xmlns:xbl="http://www.mozilla.org/xbl">
			<xul:vbox flex="1">
				<xul:hbox class="dialog-header">
					<xul:label value="&amp;modules.uixul.bo.layout.SaveTemplate-Header;" class="dialog-title" />
					<xul:spacer flex="1" />
					<xul:vbox pack="center">
						<xul:toolbarbutton height="16" width="16" change:icon="delete/small" oncommand="onCancel();" tooltiptexts="&amp;modules.uixul.bo.dialog.Cancel;" />
					</xul:vbox>
				</xul:hbox>
				<cmessageinfo anonid="message-box" />	
				<xul:vbox flex="1">
					<xul:groupbox>
						<xul:caption change:i18nattr="label &modules.uixul.bo.layout.SaveTemplate-Mandatory;" />
						<xul:grid>
							<xul:columns>
								<xul:column flex="1"/>
								<xul:column flex="3" />
							</xul:columns>
							<xul:rows>
								<xul:row align="center">
									<xul:clabel id="savetpl_label_label" change:i18nattr="value &modules.uixul.bo.layout.SaveTemplate-LabelLabel;" control="savetpl_label">
										<xul:observes element="savetpl_label" attribute="error" />
									</xul:clabel>
									<xul:cfield fieldtype="text" name="label" size="40" id="savetpl_label" anonid="savetpl_label" hidehelp="true" required="true">
										<xul:cconstraint name="maxSize" parameter="80" />
									</xul:cfield>
								</xul:row>
							</xul:rows>
						</xul:grid>
					</xul:groupbox>
					<xul:groupbox>
						<xul:caption change:i18nattr="label &modules.uixul.bo.layout.SaveTemplate-Optional;" />
						<xul:grid>
							<xul:columns>
								<xul:column flex="1"/>
								<xul:column flex="3" />
							</xul:columns>
							<xul:rows>
								<xul:row align="center">
									<xul:clabel id="savetpl_description_label" change:i18nattr="value &modules.uixul.bo.layout.SaveTemplate-DescriptionLabel;" 
												control="savetpl_description"/>
									<xul:cfield fieldtype="longtext" name="description" rows="2" cols="50" id="savetpl_description" anonid="savetpl_description" hidehelp="true" />
								</xul:row>
							</xul:rows>
						</xul:grid>
					</xul:groupbox>
				</xul:vbox>
				<hbox>
					<button disabled="true" change:icon="check/small" anonid="submitButton" oncommand="onOk();" 
					label="&amp;modules.uixul.bo.dialog.Apply;" />
				</hbox>
			</xul:vbox>
		</xbl:content>
	</binding>
</bindings>